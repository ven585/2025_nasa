<!doctype html>
<html>
<head>
  <title>Northern Lights and Network Frights: A Space Weather Adventure</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --card-bg: rgba(255,255,255,0.95);
      --accent: #FF5A5F; /* Brighter, kid-friendly red */
      --heading: #4A90E2; /* Brighter blue for headings */
      --text: #333333;
      --highlight-text: #F5A623; /* Fun yellow/orange highlight */
    }

    /* Background inspired by StoryBee pastel / sky look */
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 20px 12px;
      color: var(--text);
      line-height: 1.6;
      background:
        radial-gradient(circle at 10% 10%, rgba(255,255,255,0.40), transparent 10%),
        radial-gradient(circle at 90% 90%, rgba(200,220,255,0.45), transparent 12%),
        linear-gradient(180deg, #e0f0ff 0%, #fffaff 40%, #e0f8ff 100%); /* Lighter, more vibrant background */
      min-height: 100vh;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .story-container {
      max-width: 800px; /* Slightly smaller for a book feel */
      margin: 28px auto;
      padding: 15px;
    }

    h1 {
      text-align: center;
      color: var(--heading);
      font-size: 2.5em;
      margin: 10px 0 20px;
      letter-spacing: 0.5px;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.1); /* Subtle fun effect */
    }

    h2 {
      color: var(--heading);
      border-left: 8px solid var(--accent); /* Thicker accent line */
      padding-left: 15px;
      margin-top: 40px;
      font-size: 1.5em;
      font-weight: 700;
    }
    
    /* Style for the inline info link (GOES) */
    .info-link {
        color: var(--accent);
        text-decoration: underline;
        cursor: pointer;
        font-weight: 700;
        text-shadow: 0 0 1px rgba(0,0,0,0.1);
    }
    .info-link:hover {
        color: var(--heading);
    }

    p { font-size: 1.05em; color: var(--text); text-align: justify; margin: 15px 0; }

    .section-card {
      background: var(--card-bg);
      border-radius: 20px; /* Rounded corners for a softer look */
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1); /* Deeper shadow */
      padding: 30px;
      margin-bottom: 35px;
      transition: transform .3s ease, box-shadow .3s ease;
      border: 1px solid #eee;
    }
    .section-card:hover { transform: translateY(-8px) rotate(-0.5deg); box-shadow: 0 20px 50px rgba(0,0,0,0.15); } /* Playful hover */

    .image-wrapper { text-align: center; margin: 15px 0; }
    .image-wrapper img { max-width: 90%; height: auto; border-radius: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); border: 4px solid #fff; }
	
	.image-wrapper-act { text-align: center; margin: 15px 0; }
    .image-wrapper-act img { max-width: 100%; border-radius: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); }

    /* highlight styling aligned with highlight color */
    .highlight { font-weight: 800; color: var(--highlight-text); text-shadow: 0 0 1px #333; }

    table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 0.9em; border-radius: 10px; overflow: hidden; }
    th, td { border: none; padding: 12px; text-align: center; vertical-align: middle; }
    th { background: var(--heading); color: white; font-weight: 700; text-transform: uppercase; }
    tr:nth-child(even) { background: #f0f8ff; } /* Zebra striping */
    tr:nth-child(odd) { background: #ffffff; }
    td.left { text-align: left; font-weight: 600; color: var(--heading); }

    .video-wrapper { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 15px; margin-top: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
    .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }

    button { 
        padding: 12px 24px; 
        background-color: var(--accent); 
        color: white; 
        border: 2px solid #fff; /* Button outline */
        border-radius: 25px; 
        cursor: pointer; 
        font-size: 16px; 
        font-weight: 700;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        transition: all 0.2s ease;
    }
    button:hover { 
        background-color: #FF7777; /* Slightly lighter on hover */
        transform: scale(1.05) translateY(-2px); 
        box-shadow: 0 6px 15px rgba(0,0,0,0.3);
    }

    /* New styles for the custom audio player */
    .audio-player {
        margin: 15px auto 25px auto;
        max-width: 600px;
    }
    .controls-wrapper {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 10px;
        background: #f0f8ff; /* Light background for controls */
        border: 1px solid #d0e0ff;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }
    .audio-player button {
        flex-shrink: 0;
        padding: 8px 15px;
        font-size: 1.0em;
        line-height: 1;
    }
    .progress-container {
        flex-grow: 1;
        height: 10px;
        background: #e0e0e0;
        border-radius: 5px;
        overflow: hidden;
        cursor: pointer; /* Allows seeking */
    }
    .progress-bar {
        height: 100%;
        width: 0%;
        background-color: var(--heading); /* Blue progress bar */
        transition: width 0.1s linear;
    }

    /* Quiz modal */
    #quiz-modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0; top: 0; right: 0; bottom: 0;
      background-color: rgba(6,10,20,0.85); /* Darker overlay */
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }
    .quiz-container {
      width: 100%;
      max-width: 700px; /* More manageable quiz size */
      max-height: 90vh;
      overflow: auto;
      border-radius: 15px;
      background: linear-gradient(180deg, #374785 0%, #1f2746 100%); /* Deep space colors */
      color: #fff;
      padding: 30px;
      box-shadow: 0 25px 80px rgba(0,0,0,0.8);
      position: relative;
      border: 5px solid var(--accent); /* Accent border */
    }
    .quiz-container h1 { color: #fff; margin-top: 0; font-size: 2em; }
    .quiz-container p { color: #e0f0ff; text-align: left; }
    .close-button { position: absolute; right: 20px; top: 15px; font-size: 32px; cursor: pointer; color: var(--accent); text-shadow: 1px 1px 3px #000; }

    .quiz-question { margin: 20px 0; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px; }
    .options { margin-top: 10px; display: grid; gap: 10px; }
    .option { background: rgba(255,255,255,0.08); padding: 12px; border-radius: 8px; display:flex; align-items:center; gap:12px; cursor:pointer; border: 1px solid transparent; transition: background 0.2s, border-color 0.2s; }
    .option:hover { background: rgba(255,255,255,0.15); border-color: var(--accent); }
    .option input { transform: scale(1.2); accent-color: var(--accent); }
    .result { margin-top: 10px; font-weight:800; }
    .correct { color: #A8FF78; } /* Bright Green */ 
    .incorrect { color: #FFD25F; } /* Warm Yellow for "incorrect" feedback */

    #results { margin-top: 25px; padding: 20px; background: rgba(255,255,255,0.15); border-radius: 10px; color: #fff; }
    /* IMPORTANT: Changed score color to red as requested */
    #results p strong { color: var(--accent); font-size: 1.2em; text-shadow: 1px 1px 5px rgba(0,0,0,0.5); }

    /* Event popup modal */
    #event-modal { display:none; position: fixed; z-index:2100; left:0; top:0; right:0; bottom:0; background: rgba(0,0,0,0.75); align-items:center; justify-content:center; padding:16px; }
    .event-card { width:100%; max-width:550px; background:white; color:#122; border-radius:15px; padding:20px; box-shadow:0 25px 80px rgba(0,0,0,0.5); border: 4px solid var(--highlight-text); }
    .event-card img { width:100%; border-radius:10px; margin-bottom:10px; }
    .event-card .close { float:right; cursor:pointer; font-size:24px; color:var(--accent); font-weight: bold; }

    /* responsive */
    @media (max-width:600px){
      .story-container { padding: 10px; }
      h1{ font-size:1.6em; }
      h2{ font-size:1.3em; }
      .quiz-container{ padding:20px; }
      th, td{ font-size:0.8em; padding:6px; }
      .controls-wrapper { flex-direction: column; gap: 10px; }
      .audio-player button { width: 100%; }
      .progress-container { width: 100%; }
    }
  </style>
</head>
<body>
  <div class="story-container">

    <h1>Northern Lights and Network Frights: A Space Weather Adventure! üöÄ</h1>
    <div class="audio-player">
      <audio id="foreword-audio" src="audios/audio.mp3" preload="metadata"></audio>
      <div class="controls-wrapper">
          <button id="play-pause-button" aria-label="Play">‚ñ∂Ô∏è Listen to the Story</button>
          <div id="progress-container" class="progress-container" aria-label="Audio progress bar">
              <div id="progress-bar" class="progress-bar"></div>
          </div>
      </div>
    </div>

    <div class="section-card">
      <h2>Foreword: Welcome to Space Weather! ‚òÄÔ∏è</h2>
      <p>You know about rain, snow, and wind on Earth. But have you ever heard of **Space Weather**? It's like a big, invisible storm coming from the Sun!</p>
      <p>Sometimes, these space storms are hard to predict, even with super-smart telescopes. Guess what? Some people on Earth actually get excited about them! Why don't more people know about this amazing stuff?</p>
      <p>Get ready for a cool story about Alex and Chloe, who learn all about these solar secrets. There‚Äôs a fun quiz at the end! Alex and Chloe got a perfect score. Let's see if you can too!</p>
    </div>

    <div class="section-card">
      <h2>The Trip to Greenland: Hello, Ice! üëã</h2>
      <p>Three friends started a big adventure to Greenland: Alex the Photographer (who loves snapping pics), Chloe the Cyber Expert (who loves computers), and Ben the Space Scientist (who would join them a day later). Alex hoped to capture the glowing **Northern Lights**. Chloe planned to work on her critical project while enjoying the view.</p>
      <div class="image-wrapper">
        <img src="images/1_background.png" alt="Alex and Chloe arriving in Greenland." />
      </div>
    </div>

    <div class="section-card">
      <h2>Super-Power Lights and Broken Internet! üíî</h2>
      <p>As soon as they arrived, Alex shouted with excitement! The **Aurora Borealis** (that's the fancy name for the Northern Lights) was glowing brighter and more colorful than ever. He started clicking photos right away.</p>
      <p>But Chloe frowned. Her computer screen showed a big red 'X'‚Äîthe internet and their walkie-talkie communications were completely **down**!</p>
      <div class="image-wrapper">
        <img src="images/2_day_of_reaching.png" alt="Auroras and network outage." />
      </div>
    </div>

    <div class="section-card">
      <h2>The Secret is Revealed: Ben Explains! ü§´</h2>
      <p>The next morning, Ben the scientist arrived. Alex showed him the amazing photos, and Chloe showed him the network error. Ben just smiled.</p>
      <div class="image-wrapper">
        <img src="images/3_scientist_joins.png" alt="The three friends discussing." />
      </div>
      <p>Ben explained: "Friends, the beautiful lights and the broken network are both two sides of the same coin! They're both caused by one powerful thing: the **<span class="highlight">Space Weather</span>**!"</p>
      <p>"Let me show you a quick video that explains what this Space Weather is and how it tickles our Earth."</p>

      <div class="video-wrapper">
        <iframe width="560" height="315" src="https://www.youtube.com/embed/nu-nqOJU55s?start=0&end=129&rel=0&showinfo=0&modestbranding=1&controls=0" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
      </div>
      
      <p style="font-size:0.9em; color:#666; text-align:center;">**Video Credit: European Space Agency (ESA)**</p>
    </div>

    <div class="section-card">
      <h2>Understanding the Power: What Else Happens? ü§î</h2>
      <p>Alex: "Wow! So the Space Weather makes the lights so beautiful! That's cool!"</p>
      <p>Chloe: "Oh dear! So the Space Weather is why my network broke! But does it only break networks? When did these big solar storms start? And what are the different types of Space Weather events?"</p>
    </div>

    <div class="section-card">
      <h2>More Impacts: Space-Junk Surprise! üõ∞Ô∏è</h2>
      <p>Ben: "Great questions! Firstly, Space Weather can affect lots of things. It can mess with radio signals, make power grids rumble, and even cause problems for **satellites** orbiting Earth! Look at this picture to see all the places it touches."</p>
      <div class="image-wrapper-act">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3b/Space_weather_effects.jpg/1000px-Space_weather_effects.jpg" alt="Space weather effects diagram">
        <p style="font-size:0.9em; color:#666; text-align:center;">**Image Credit: ESA/Science Office**</p>
      </div>
    </div>

    <div class="section-card">
      <h2>Historical Timeline: Old Stories! üï∞Ô∏è</h2>
      <p>Ben continued to explain...</p>
	  <p>Secondly, these space storms have been happening for hundreds of years! They are quite **rare**, which is why most people don't worry about them every day. For example, happening of a super-huge storm called a CME in a decade is less than 12%! Here are some of the biggest space weather events from the past.</p>
      <div class="image-wrapper-act">
        <img src="images/Timeline.png" alt="Space weather effects diagram">
      </div>
      </div>

    <div class="section-card">
      <h2>Star-Storm Rumble: The Three Big Events! üí•</h2>
      <p>Ben continued to explain...</p>
	  <p>Thirdly, there are three main types of explosions and eruptions that cause our Space Weather!</p>

      <table>
        <thead>
          <tr>
            <th>What is it?</th>
            <th>Solar Flares üî•</th>
            <th>Coronal Mass Ejections (CME) üí£</th>
            <th>Solar Energetic Particle Events (SEP) ‚ö°</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="left"><strong>What it looks like</strong></td>
            <td>A massive, bright flash of light and X-rays from the Sun.</td>
            <td>A giant bubble of magnetic energy and gas bursting from the Sun.</td>
            <td>A speedy blast of tiny, high-energy particles.</td>
          </tr>
          <tr>
            <td class="left"><strong>What it does</strong></td>
            <td>Quickly messes up radio and GPS signals (but only on the side facing the Sun).</td>
            <td>Causes magnetic storms, brings the Northern Lights, and can hurt power grids.</td>
            <td>A danger to astronauts and damages sensitive equipment on satellites.</td>
          </tr>
          <tr>
            <td class="left"><strong>How fast does it hit Earth?</strong><br/></td>
            <td>8 minutes (super fast, the speed of light!)</td>
            <td>1‚Äì3 days (Fast, but gives us time to prepare)</td>
            <td>Minutes to a few hours (Depends on how fast the particles are zooming!)</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="section-card">
      <h2>Nothing Lasts Forever: Time to Chill! üòå</h2>
      <p>Ben: "Don't worry, Chloe. The solar event won't last forever. I just got a reading from the special <a href="#" class="info-link" data-info="goes">GOES R-Series satellites</a>. Most big flares and CMEs calm down within a day."</p>
      <p><em>Chloe responded:</em> "That makes me feel much better, Ben! We'll just wait it out and plan to get back online once the sky-layers (the ionosphere) are stable again." </p>
    </div>

    <div class="section-card">
      <h2>Recovery Time: Back to Smiles! üòÅ</h2>
      <p>Just as Ben said, the space storm settled down, and everything went back to normal. Chloe was very happy to get back to her important computer work! Now, there was a big smile on her face again.</p>
      <div class="image-wrapper">
        <img src="images/Chloe_delighted.png" alt="Chloe smiling, happy that the network is back" />
      </div>	  
    </div>
	
    <div class="section-card">
      <h2>The Conclusion: What an Adventure! ü•≥</h2>
      <p>The three friends stayed in Greenland for one more happy day. Ben suggested they take a fun final test to see what they learned. Alex and Chloe both took the quiz and scored a perfect **10 out of 10**!</p>
      
      <p>Finally, Alex, Chloe, and Ben all headed home. The Photographer and the Cyber Expert had learned so much about the beautiful, amazing, and sometimes scary power of Space Weather. It was a polar adventure they would never, ever forget!</p>

      <div class="image-wrapper">
        <img src="images/10_leaving_greenland.png" alt="Three friends leaving Greenland" />
      </div>
    </div>
	
    <div class="section-card">
      <h2>Test your Super-Science Knowledge! üí°</h2>
      <p>You listened to the story! Now, show off your knowledge with this quick quiz.</p>
      <button id="start-quiz">Start the Space Weather Quiz!</button>
    </div>
    
    <p style="text-align: center; margin-top: 40px; font-size: 1.2em; font-weight: 600; color: var(--heading);">
        Hope you learned about space weather.
    </p>
    <p style="text-align: center; margin-top: 0px; font-size: 1.2em; font-weight: 600; color: var(--heading);">
        Thank you!
    </p>
  </div>

  <div id="event-modal" role="dialog" aria-hidden="true">
    <div class="event-card" id="event-card">
      <span class="close" id="event-close">‚úï</span>
      <h3 id="event-title">Event title</h3>
      <img id="event-image" src="" alt="" />
      <p id="event-info"></p>
      <p style="font-size:0.8em;color:#777; text-align:center;">Information from GOES satellites.</p>
    </div>
  </div>

  <div id="quiz-modal" style="display:none;" aria-hidden="true">
    <div class="quiz-container" role="document">
      <span class="close-button" id="quiz-close">√ó</span>
      <h1>Space Weather Quiz üõ∞Ô∏è</h1>
      <p style="color:#d9e9ff;">Answer the questions based only on the story content above.</p>
      <div id="quiz-content"></div>
      <div id="results" style="display:none;"></div>
      <div style="text-align:right; margin-top:20px;">
          <button id="bottom-close-quiz">Close Quiz</button>
      </div>
    </div>
  </div>

<script>
    /* ---------- Event/Info modal data ---------- */
    const eventData = {
      // GOES Information Added Here
      goes: {
        title: "GOES Satellites: Space Weather Watchdogs",
        img: "https://upload.wikimedia.org/wikipedia/commons/e/ea/GOES-R_satellite_in_space.jpg",
        info: "GOES (Geostationary Operational Environmental Satellites) satellites are super important for predicting Space Weather! They keep their eyes glued to the Sun to see when a big solar storm is coming. This gives people time to prepare and protect things like communications, GPS, and the power grid. They use cool tools like the Compact Coronagraph-1 (CCOR-1) to see big solar flares and solar bursts (CMEs) happening in real-time!"
      },
      // Existing event data (Simplified info for child-friendly tone, though main story doesn't link to these directly)
      miyake: {
        title: "Miyake Event (774‚Äì775 AD)",
        img: "images/SEP_event.png",
        info: "A super strong blast of solar particles that happened long ago! Scientists know about it because they found traces in old trees!"
      },
      carrington: {
        title: "Carrington Event (1859)",
        img: "images/carrington.png",
        info: "The biggest magnetic storm ever recorded! It caused the telegraph system (the old internet!) to catch fire and made the Northern Lights visible even near the Equator."
      },
      nyrail: {
        title: "New York Railroad Storm (1921)",
        img: "https://upload.wikimedia.org/wikipedia/commons/3/3b/Space_weather_effects.jpg",
        info: "A storm that caused electric surges, tripping fuses and making power jump where it shouldn't."
      },
      coldwar: {
        title: "Cold War Storm (1967)",
        img: "https://upload.wikimedia.org/wikipedia/commons/3/3b/Space_weather_effects.jpg",
        info: "This storm messed up early radar and communication systems, making people think they were being attacked!"
      },
      quebec: {
        title: "Qu√©bec Blackout (1989)",
        img: "https://upload.wikimedia.org/wikipedia/commons/6/63/Hydro-Quebec_-_Blackout_Map.png",
        info: "A big solar storm caused the power grid in a whole province (Qu√©bec) to fail, leading to a huge blackout!"
      },
      halloween: {
        title: "Halloween Storms (2003)",
        img: "https://upload.wikimedia.org/wikipedia/commons/3/3b/Space_weather_effects.jpg",
        info: "Powerful storms that hurt some orbiting satellites and caused problems for astronauts."
      },
      near_miss: {
        title: "The Near Miss (2012)",
        img: "https://upload.wikimedia.org/wikipedia/commons/3/3b/Space_weather_effects.jpg",
        info: "A giant solar burst, just like the Carrington Event, that zoomed past Earth! We were lucky!"
      },
      g5_2024: {
        title: "G5 Geomagnetic Storm (2024)",
        img: "https://upload.wikimedia.org/wikipedia/commons/3/3b/Space_weather_effects.jpg",
        info: "A big recent magnetic storm that caused beautiful auroras you could see far south and made GPS a little shaky for a short time."
      }
    };

    // Open info popup (Updated selector to .info-link)
    document.querySelectorAll('.info-link').forEach(el=>{
      el.addEventListener('click', function(e){
        e.preventDefault();
        const key = el.getAttribute('data-info'); // Use data-info attribute
        const d = eventData[key];
        if(!d) return;
        
        // Populate modal with GOES data
        document.getElementById('event-title').textContent = d.title;
        document.getElementById('event-image').src = d.img;
        document.getElementById('event-info').textContent = d.info;
        
        document.getElementById('event-modal').style.display = 'flex';
        document.getElementById('event-modal').setAttribute('aria-hidden','false');
      });
    });
    
    // Original event-link logic (Kept for compatibility with other links if any exist/are added later)
    document.querySelectorAll('.event-link').forEach(el=>{
      el.addEventListener('click', function(e){
        e.preventDefault();
        const key = el.getAttribute('data-event');
        const d = eventData[key];
        if(!d) return;
        document.getElementById('event-title').textContent = d.title;
        document.getElementById('event-image').src = d.img;
        document.getElementById('event-info').textContent = d.info;
        document.getElementById('event-modal').style.display = 'flex';
        document.getElementById('event-modal').setAttribute('aria-hidden','false');
      });
    });
    
    // Close modal function
    function closeEventModal() {
        document.getElementById('event-modal').style.display='none';
        document.getElementById('event-modal').setAttribute('aria-hidden','true');
    }
    
    document.getElementById('event-close').addEventListener('click', closeEventModal);
    document.getElementById('event-modal').addEventListener('click', (e)=>{ if(e.target.id==='event-modal') closeEventModal(); });


    /* ---------- QUIZ: questions + dynamic generation & shuffle ---------- */
    // Questions are strictly based on story facts
    const quizQuestions = [
      {
        id: 'q1',
        q: 'What caused the beautiful auroras (Northern Lights)?',
        options: [
          {value:'solar_wind', label:'Charged particles from the Sun hitting Earth\'s protective shield (magnetosphere)'},
          {value:'earth_weather', label:"Earth's humidity and cold air"},
          {value:'meteors', label:'Burning space rocks (meteors) in the sky'}
        ],
        correct: 'solar_wind'
      },
      {
        id: 'q2',
        q: 'Which space event caused network and communications to break?',
        options: [
          {value:'cme', label:'A Coronal Mass Ejection (CME) and the magnetic storm it caused'},
          {value:'sunspots', label:'Normal sunspots on the Sun'},
          {value:'eclipse', label:'A solar eclipse'}
        ],
        correct: 'cme'
      },
      {
        id: 'q3',
        q: 'Which systems did the story say Space Weather can affect?',
        options: [
          {value:'gps_satellites', label:'GPS, radio, and communication satellites'},
          {value:'local_power', label:'Only local earthquakes'},
          {value:'earthquakes', label:'The rumbling of Earthquakes'}
        ]
      ,
        correct: 'gps_satellites'
      },
      {
        id: 'q4',
        q: 'What are Auroras also known as?',
        options: [
          {value:'lights', label:'Northern/Southern Lights'},
          {value:'storms', label:'Sky Storms'},
          {value:'winds', label:'Space Winds'}
        ],
        correct: 'lights'
      },
      {
        id: 'q5',
        q: 'Which one of the three main solar events hits Earth the fastest (in only 8 minutes)?',
        options: [
          {value:'flares', label:'Solar Flares üî•'},
          {value:'cme', label:'Coronal Mass Ejections üí£'},
          {value:'sep', label:'Solar Energetic Particle Events ‚ö°'}
        ],
        correct: 'flares'
      },
      {
        id: 'q6',
        q: 'Which is a main threat of Solar Energetic Particle Events (SEPs)?',
        options: [
          {value:'radiation', label:'Radiation danger for astronauts and satellites'},
          {value:'gravity', label:'Sudden changes in Earth\'s gravity'},
          {value:'temperature', label:'Rapid drop in temperature in Greenland'}
        ],
        correct: 'radiation'
      },
      {
        // *** MODIFIED QUESTION 7 to be unique ***
        id: 'q7',
        q: 'Which solar event takes 1‚Äì3 days to travel from the Sun to Earth?',
        options: [
          {value:'cme', label:'Coronal Mass Ejections üí£'},
          {value:'flares', label:'Solar Flares üî•'},
          {value:'sep', label:'Solar Energetic Particle Events ‚ö°'}
        ],
        correct: 'cme'
      },
      {
        // *** MODIFIED QUESTION 8 ***
        id: 'q8',
        q: 'Which space weather event primarily causes magnetic storms and affects power grids?',
        options: [
          {value:'cme', label:'Coronal Mass Ejections üí£'},
          {value:'flares', label:'Solar Flares üî•'},
          {value:'sep', label:'Solar Energetic Particle Events ‚ö°'}
        ],
        correct: 'cme'
      },
      {
        id: 'q9',
        q: 'The story mentioned that disruptions happen in which layer of Earth\'s atmosphere (the "sky-layers")?',
        options: [
          {value:'ionosphere', label:'The ionosphere'},
          {value:'troposphere', label:'The troposphere (where clouds are)'},
          {value:'mesosphere', label:'The mesosphere'}
        ],
        correct: 'ionosphere'
      },
      {
        id: 'q10',
        q: 'Which satellites did Ben check to see if the storm was calming down?',
        options: [
          {value:'goes', label:'The GOES R-Series Satellites'},
          {value:'hubble', label:'The Hubble Telescope'},
          {value:'moon_rover', label:'A Moon Rover'}
        ],
        correct: 'goes'
      }
    ];

    // Utility: random shuffle array
    function shuffleArray(a){
      for(let i=a.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
      }
      return a;
    }

    const quizModal = document.getElementById('quiz-modal');
    const quizContent = document.getElementById('quiz-content');
    const resultsDiv = document.getElementById('results');

    // **FIXED: Ensure the quiz modal starts hidden if it wasn't already**
    quizModal.style.display = 'none';

    // Build quiz dynamically each time - ensures shuffling + reset
    function openQuiz(){
      // reset UI
      resultsDiv.style.display='none';
      resultsDiv.innerHTML='';
      quizContent.innerHTML='';

      // Deep copy questions to avoid mutating original
      const questions = JSON.parse(JSON.stringify(quizQuestions));

      // build HTML
      questions.forEach((qq, idx)=>{
        // shuffle options
        qq.options = shuffleArray(qq.options);
        const qDiv = document.createElement('div');
        qDiv.className = 'quiz-question';
        qDiv.id = 'block-' + qq.id;

        const qHtml = document.createElement('div');
        qHtml.innerHTML = `<strong>Q${idx+1}.</strong> ${qq.q}`;
        qDiv.appendChild(qHtml);

        const opts = document.createElement('div');
        opts.className = 'options';

        qq.options.forEach(opt=>{
          const optId = qq.id + '_' + opt.value + '_' + Math.random().toString(36).slice(2,7);
          const label = document.createElement('label');
          label.className = 'option';
          label.htmlFor = optId;
          label.innerHTML = `<input type="radio" name="${qq.id}" id="${optId}" value="${opt.value}" /> <span>${opt.label}</span>`;
          opts.appendChild(label);
        });

        qDiv.appendChild(opts);

        // feedback placeholder
        const fb = document.createElement('div');
        fb.id = 'feedback-' + qq.id;
        fb.className = 'result';
        qDiv.appendChild(fb);

        quizContent.appendChild(qDiv);
      });

      // Submit button
      const submitBtn = document.createElement('div');
      submitBtn.style.marginTop = '15px';
      submitBtn.style.textAlign = 'center';
      submitBtn.innerHTML = '<button id="submit-quiz">Submit My Answers! ‚ú®</button>';
      quizContent.appendChild(submitBtn);

      document.getElementById('submit-quiz').addEventListener('click', ()=> checkQuiz(questions));

      // show modal
      quizModal.style.display = 'flex';
      quizModal.setAttribute('aria-hidden','false');
      // ensure scroll to top of quiz modal
      document.querySelector('.quiz-container').scrollTop = 0;
    }

    // Added a function to close the quiz modal
    function closeQuiz() {
        quizModal.style.display='none'; 
        quizModal.setAttribute('aria-hidden','true');
    }

    // Attach start button
    document.getElementById('start-quiz').addEventListener('click', openQuiz);
    // Close handlers
    document.getElementById('quiz-close').addEventListener('click', closeQuiz);
    document.getElementById('bottom-close-quiz').addEventListener('click', closeQuiz); 
    quizModal.addEventListener('click', (e)=>{ if(e.target === quizModal) { closeQuiz(); } });

    // Check quiz answers - resets score each attempt
    function checkQuiz(questions){
      let score = 0;
      questions.forEach(q=>{
        const selected = document.querySelector('input[name="'+q.id+'"]:checked');
        const fb = document.getElementById('feedback-' + q.id);
        if(selected && selected.value === q.correct){
          score++;
          fb.textContent = 'Correct!';
          fb.className = 'result correct';
        } else if(selected){
          // show which answer is correct in a friendly way
          const correctLabel = q.options.find(o=>o.value===q.correct)?.label || 'correct answer';
          fb.textContent = 'Incorrect. The correct answer was: ' + correctLabel;
          fb.className = 'result incorrect';
        } else {
          const correctLabel = q.options.find(o=>o.value===q.correct)?.label || 'correct answer';
          fb.textContent = 'Unanswered. The correct answer was: ' + correctLabel;
          fb.className = 'result incorrect';
        }
      });

      resultsDiv.style.display='block';
      resultsDiv.innerHTML = `<h2>Quiz Complete! üéâ</h2><p style="font-size:1.05em; color: #fffaf2; text-align:center;">**Your Final Score: ${score}** / ${questions.length}</p>`;
      // scroll results into view
      document.querySelector('.quiz-container').scrollTop = document.querySelector('.quiz-container').scrollHeight;
    }

    /* Accessibility: close quiz with ESC */
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape'){
        if(quizModal.style.display === 'flex') { closeQuiz(); }
        if(document.getElementById('event-modal').style.display === 'flex') closeEventModal();
      }
    });

    /* Prevent accidental form submissions */
    document.addEventListener('submit', (e)=> e.preventDefault());


    /* ---------- Custom Audio Player Logic (New addition) ---------- */
    const audio = document.getElementById('foreword-audio');
    const playPauseBtn = document.getElementById('play-pause-button');
    const progressContainer = document.getElementById('progress-container');
    const progressBar = document.getElementById('progress-bar');

    if (audio && playPauseBtn && progressContainer && progressBar) {
        // Toggle play/pause
        playPauseBtn.addEventListener('click', () => {
            if (audio.paused || audio.ended) {
                // IMPORTANT: The audio file at 'audios/audio.mp3' must be accessible
                // for the play command to succeed.
                audio.play().catch(error => {
                    console.error('Playback failed. Please ensure audios/audio.mp3 is available.', error);
                    // Provide visual feedback if playback fails (e.g., due to file not found)
                    playPauseBtn.innerHTML = '‚ö†Ô∏è Error Playing';
                    setTimeout(() => playPauseBtn.innerHTML = '‚ñ∂Ô∏è Play Story', 3000);
                });
            } else {
                audio.pause();
            }
        });

        // Update button appearance on play/pause
        audio.addEventListener('play', () => {
            playPauseBtn.innerHTML = '‚è∏Ô∏è Pause Story';
            playPauseBtn.setAttribute('aria-label', 'Pause');
        });

        audio.addEventListener('pause', () => {
            playPauseBtn.innerHTML = '‚ñ∂Ô∏è Play Story';
            playPauseBtn.setAttribute('aria-label', 'Play');
        });

        // Update progress bar
        audio.addEventListener('timeupdate', () => {
            if (!isNaN(audio.duration)) {
                const percent = (audio.currentTime / audio.duration) * 100;
                progressBar.style.width = percent + '%';
            }
        });
        
        // Handle seeking by clicking on the progress container
        progressContainer.addEventListener('click', (e) => {
            if (!isNaN(audio.duration)) {
                // Calculate time based on click position
                const clickX = e.offsetX;
                const width = progressContainer.clientWidth;
                const duration = audio.duration;
                audio.currentTime = (clickX / width) * duration;
            }
        });
    }
  </script>
</body>
</html>